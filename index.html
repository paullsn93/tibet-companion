<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tibet Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        /* Drawer Transition */
        .drawer-enter-active,
        .drawer-leave-active {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        .drawer-enter-from,
        .drawer-leave-to {
            transform: translateY(100%);
            opacity: 0;
        }

        /* Backdrop Transition */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }
    </style>
</head>
<!-- Body: h-screen, overflow-hidden to prevent browser scroll -->

<body
    class="bg-slate-950 text-slate-100 h-screen w-screen overflow-hidden flex flex-col items-center selection:bg-cyan-500/30 touch-none">

    <div id="app"
        class="w-full max-w-[1600px] h-full flex flex-col md:flex-row md:gap-8 md:p-8 relative overflow-hidden">

        <!-- Desktop Sidebar (md:block hidden) -->
        <aside
            class="hidden md:flex flex-col w-[360px] h-full bg-slate-900/50 backdrop-blur-md border border-slate-800 rounded-3xl overflow-hidden shrink-0 shadow-2xl">
            <!-- Sidebar Header -->
            <div class="p-8 border-b border-slate-800 bg-slate-900/80">
                <h1
                    class="text-2xl font-black bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent flex items-center gap-2">
                    <span class="material-icons-outlined text-cyan-400 text-3xl">landscape</span>
                    Tibet Companion
                </h1>
                <p class="text-sm text-slate-500 mt-2 font-medium tracking-wide">西藏旅伴 12日行程助手</p>
            </div>

            <!-- Sidebar List -->
            <div class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar">
                <button v-for="(day, idx) in itinerary" :key="idx" @click="selectDay(idx)"
                    class="w-full text-left p-4 rounded-xl transition-all flex items-center gap-4 group relative overflow-hidden"
                    :class="currentIndex === idx ? 'bg-cyan-900/20 border border-cyan-500/30' : 'hover:bg-slate-800/50 border border-transparent'">
                    <!-- Selection Bar -->
                    <div v-if="currentIndex === idx" class="absolute left-0 top-0 bottom-0 w-1.5 bg-cyan-500"></div>

                    <!-- Day Indicator -->
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0 font-mono font-bold text-lg transition-colors"
                        :class="currentIndex === idx ? 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/20' : 'bg-slate-800 text-slate-400 group-hover:bg-slate-700 group-hover:text-slate-200'">
                        {{ day.day }}
                    </div>

                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <span class="text-base font-bold truncate"
                                :class="currentIndex === idx ? 'text-cyan-100' : 'text-slate-300 group-hover:text-white'">
                                {{ day.locations[day.locations.length - 1] }}
                            </span>
                        </div>
                        <div class="flex items-center gap-2 text-sm mt-1">
                            <span class="text-slate-500 group-hover:text-slate-400 truncate">{{ day.title }}</span>
                            <!-- Altitude Badge -->
                            <span
                                class="ml-auto px-2 py-0.5 rounded bg-slate-950 text-slate-400 font-mono border border-slate-800 whitespace-nowrap text-xs"
                                :class="{'text-amber-400 border-amber-900/30': day.altitude.sleep > 3500}">
                                {{ day.altitude.sleep }}m
                            </span>
                        </div>
                    </div>
                </button>
            </div>

            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-slate-800 bg-slate-900/30 text-center">
                <button @click="resetToToday"
                    class="text-sm text-cyan-500 hover:text-cyan-400 font-bold tracking-wider uppercase flex items-center justify-center gap-2 w-full py-3 rounded-xl hover:bg-cyan-950/30 transition-colors">
                    <span class="material-icons-outlined text-lg">today</span>
                    Back to Today
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 w-full h-full flex flex-col relative overflow-hidden">
            <!-- Scrollable Content Container -->
            <!-- ADDED: touch-action: pan-y to ensure vertical scrolling works on mobile -->
            <div class="flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar pb-32 md:pb-0 px-4 pt-4 md:px-0 md:pt-0 scroll-smooth touch-pan-y"
                style="-webkit-overflow-scrolling: touch;">
                <div class="max-w-4xl mx-auto space-y-8 md:space-y-10">

                    <!-- Header Section -->
                    <header
                        class="text-center space-y-4 mt-4 md:mt-0 transition-all duration-300 cursor-pointer md:cursor-default active:scale-95 md:active:scale-100 group"
                        v-if="currentDay" @click="width < 768 ? isDrawerOpen = true : null">
                        <!-- Top Info Bar -->
                        <div class="flex items-center justify-center gap-3">
                            <div
                                class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-slate-900 border border-slate-800 text-sm md:text-base text-slate-400 font-mono tracking-wide md:group-hover:bg-slate-900 group-hover:bg-slate-800 transition-colors shadow-lg">
                                <span class="material-icons-outlined text-lg md:hidden">menu</span>
                                {{ currentDay.date }}
                                <span v-if="isToday" class="text-emerald-400 font-bold ml-2 animate-pulse">●
                                    TODAY</span>
                            </div>

                            <!-- Map Button (New) -->
                            <a :href="googleMapsLink" target="_blank" @click.stop
                                class="inline-flex items-center gap-1.5 px-4 py-1.5 rounded-full bg-teal-500/10 border border-teal-500/30 text-teal-400 text-sm md:text-base font-bold hover:bg-teal-500/20 hover:border-teal-500/50 transition-all shadow-lg active:scale-95">
                                <span class="material-icons-outlined text-lg">map</span>
                                Map
                            </a>
                        </div>

                        <h1
                            class="text-5xl md:text-7xl font-black bg-gradient-to-br from-white via-slate-200 to-slate-500 bg-clip-text text-transparent drop-shadow-xl flex items-center justify-center gap-3 py-2">
                            Day {{ currentDay.day }}
                            <span
                                class="material-icons-outlined text-slate-600 text-4xl group-hover:text-cyan-400 transition-colors md:hidden">expand_more</span>
                        </h1>

                        <div class="flex items-center justify-center gap-3 text-cyan-400/90 font-medium">
                            <span class="material-icons-outlined text-2xl">place</span>
                            <span class="text-xl md:text-3xl tracking-wide">{{ currentDay.locations.join(' ➝ ')
                                }}</span>
                        </div>

                        <p
                            class="text-slate-400 text-lg md:text-xl font-medium border-t border-slate-800/50 pt-4 mx-4 md:mx-20 leading-relaxed">
                            {{ currentDay.title }}</p>
                    </header>

                    <!-- Loading / Error States -->
                    <div v-if="loading" class="flex flex-col items-center justify-center h-64 gap-6 text-slate-500">
                        <div class="w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin">
                        </div>
                        <p class="text-lg font-mono">載入行程資料中...</p>
                    </div>

                    <div v-else-if="error"
                        class="bg-red-950/30 border border-red-900/50 p-8 rounded-3xl text-center space-y-4 mx-4">
                        <span class="material-icons-outlined text-red-500 text-5xl">error_outline</span>
                        <h3 class="text-red-400 text-2xl font-bold">無法讀取資料</h3>
                        <p class="text-red-300/70 text-lg">{{ error }}</p>
                    </div>

                    <!-- Dashboard Grid (md:grid-cols-2) -->
                    <div v-else-if="currentDay" class="space-y-6 md:space-y-0 md:grid md:grid-cols-2 md:gap-8 pb-8">

                        <!-- Altitude Card -->
                        <div
                            class="bg-slate-900/80 backdrop-blur-sm rounded-[2rem] p-8 shadow-2xl border border-slate-800 relative overflow-hidden group hover:border-slate-700 transition-all duration-300 h-full">
                            <!-- Warning Indicator -->
                            <div v-if="isHighAltitude"
                                class="absolute top-0 right-0 bg-red-500/10 text-red-400 text-xs px-4 py-2 rounded-bl-2xl font-bold border-l border-b border-red-500/20 flex items-center gap-2 backdrop-blur-md">
                                <span class="material-icons-outlined text-sm animate-pulse">warning</span>
                                高海拔注意
                            </div>

                            <h3
                                class="text-slate-500 text-sm font-bold uppercase tracking-[0.2em] mb-6 flex items-center gap-3">
                                <span class="material-icons-outlined text-xl">landscape</span>
                                海拔監控 Altitude
                            </h3>

                            <div class="grid grid-cols-2 gap-6">
                                <div
                                    class="text-center p-6 bg-slate-950 rounded-2xl border border-slate-800/50 group-hover:border-slate-700/50 transition-colors">
                                    <div class="text-xs text-slate-500 uppercase tracking-wider mb-2">最高 (Max)</div>
                                    <div class="font-mono font-bold tracking-tight leading-none" :class="[
                                            currentDay.altitude.max > 3500 ? 'text-amber-400' : 'text-slate-200',
                                            'text-5xl md:text-6xl lg:text-7xl'
                                         ]">
                                        {{ currentDay.altitude.max }}<span
                                            class="text-lg md:text-xl ml-1 text-slate-500 align-baseline">m</span>
                                    </div>
                                </div>

                                <div
                                    class="text-center p-6 bg-slate-950 rounded-2xl border border-slate-800/50 group-hover:border-slate-700/50 transition-colors relative">
                                    <div class="text-xs text-slate-500 uppercase tracking-wider mb-2">住宿 (Sleep)</div>
                                    <div class="font-mono font-bold tracking-tight leading-none" :class="[
                                            currentDay.altitude.sleep > 3000 ? 'text-red-400' : 'text-emerald-400',
                                            'text-5xl md:text-6xl lg:text-7xl'
                                         ]">
                                        {{ currentDay.altitude.sleep }}<span
                                            class="text-lg md:text-xl ml-1 text-slate-500 align-baseline">m</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Weather Card -->
                        <div
                            class="bg-slate-900/80 backdrop-blur-sm rounded-[2rem] p-8 shadow-2xl border border-slate-800 group hover:border-slate-700 transition-all duration-300 h-full">
                            <h3
                                class="text-slate-500 text-sm font-bold uppercase tracking-[0.2em] mb-4 flex items-center gap-3">
                                <span class="material-icons-outlined text-xl text-sky-400">wb_sunny</span>
                                穿衣指引 Wear
                            </h3>
                            <p
                                class="text-slate-300 text-lg md:text-xl leading-loose font-light tracking-wide border-l-4 border-sky-500/30 pl-6 py-2">
                                {{ currentDay.weather_advice }}
                            </p>
                        </div>

                        <!-- Highlights (Spans 2 columns on Desktop) -->
                        <div
                            class="bg-slate-900/80 backdrop-blur-sm rounded-[2rem] p-8 shadow-2xl border border-slate-800 group hover:border-slate-700 transition-all duration-300 md:col-span-2">
                            <h3
                                class="text-slate-500 text-sm font-bold uppercase tracking-[0.2em] mb-6 flex items-center gap-3">
                                <span class="material-icons-outlined text-xl text-purple-400">auto_awesome</span>
                                今日亮點 Highlights
                            </h3>
                            <ul class="grid md:grid-cols-2 gap-4"> <!-- Grid for list items on desktop -->
                                <li v-for="(item, idx) in currentDay.highlights" :key="idx"
                                    class="flex items-start gap-5 group/item bg-slate-800/20 rounded-xl p-4 md:p-5 hover:bg-slate-800/40 transition-colors">
                                    <div
                                        class="mt-2 w-2 h-2 rounded-full bg-purple-500/50 shadow-[0_0_8px_rgba(168,85,247,0.4)] group-hover/item:bg-purple-400 transition-colors shrink-0">
                                    </div>
                                    <span
                                        class="text-slate-300 text-lg md:text-xl leading-relaxed group-hover/item:text-slate-100 transition-colors">{{
                                        item }}</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Safety Tips (Spans 2 columns on Desktop) -->
                        <div
                            class="bg-gradient-to-br from-amber-950/40 to-orange-950/20 rounded-[2rem] p-8 shadow-2xl border border-amber-900/30 group hover:border-amber-800/50 transition-all duration-300 relative overflow-hidden md:col-span-2">
                            <div class="absolute top-0 right-0 p-6 opacity-10 pointer-events-none">
                                <span class="material-icons-outlined text-9xl text-amber-500">lightbulb</span>
                            </div>
                            <h3
                                class="text-amber-500/90 text-sm font-bold uppercase tracking-[0.2em] mb-4 flex items-center gap-3 relative z-10">
                                <span class="material-icons-outlined text-xl">tips_and_updates</span>
                                貼心叮嚀 Tips
                            </h3>
                            <p class="text-amber-100/90 text-lg md:text-xl leading-loose font-medium relative z-10">
                                {{ currentDay.tips }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Navigation (Mobile Only) - Fixed to Bottom -->
            <footer
                class="md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] max-w-md flex items-center justify-between bg-slate-900/90 backdrop-blur-xl border border-slate-700/50 p-2 rounded-full shadow-2xl z-50">
                <button @click="changeDay(-1)" :disabled="currentIndex === 0"
                    class="w-14 h-14 rounded-full flex items-center justify-center transition-all bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed active:scale-95">
                    <span class="material-icons-outlined text-2xl">arrow_back</span>
                </button>

                <div class="flex flex-col items-center select-none cursor-pointer active:scale-95 transition-transform px-4"
                    @click="isDrawerOpen = true" role="button" title="開啟快速選單">
                    <span class="text-[10px] uppercase tracking-widest text-slate-500 font-bold mb-0.5">DAY</span>
                    <span class="text-xl font-mono font-bold text-slate-200 leading-none">{{ currentDay ? currentDay.day
                        : '-' }} / {{ itinerary.length }}</span>
                </div>

                <button @click="changeDay(1)" :disabled="!currentDay || currentIndex === itinerary.length - 1"
                    class="w-14 h-14 rounded-full flex items-center justify-center transition-all bg-cyan-600 text-white shadow-[0_4px_12px_rgba(8,145,178,0.4)] hover:bg-cyan-500 hover:shadow-[0_6px_16px_rgba(8,145,178,0.6)] disabled:opacity-30 disabled:cursor-not-allowed disabled:shadow-none active:scale-95">
                    <span class="material-icons-outlined text-2xl">arrow_forward</span>
                </button>
            </footer>
        </main>

        <!-- Navigation Drawer (Mobile Only Modal) -->
        <teleport to="body">
            <!-- Backdrop -->
            <transition name="fade">
                <div v-if="isDrawerOpen && width < 768" @click="isDrawerOpen = false"
                    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 md:hidden touch-none"></div>
            </transition>

            <!-- Drawer Content -->
            <transition name="drawer">
                <div v-if="isDrawerOpen && width < 768"
                    class="fixed bottom-0 left-0 right-0 bg-slate-900 rounded-t-3xl z-50 max-h-[85vh] h-[80vh] overflow-hidden flex flex-col shadow-[0_-4px_20px_rgba(0,0,0,0.5)] border-t border-slate-700 md:hidden">
                    <!-- Drawer Handle -->
                    <div class="w-full flex justify-center pt-4 pb-2" @click="isDrawerOpen = false">
                        <div class="w-12 h-1.5 bg-slate-700 rounded-full"></div>
                    </div>

                    <!-- Drawer Header -->
                    <div class="px-6 py-4 border-b border-slate-800 flex justify-between items-center shrink-0">
                        <h2 class="text-xl font-bold text-slate-200">快速跳轉</h2>
                        <button @click="isDrawerOpen = false"
                            class="text-slate-400 hover:text-white transition-colors p-2">
                            <span class="material-icons-outlined text-2xl">close</span>
                        </button>
                    </div>

                    <!-- Scrollable List -->
                    <div class="flex-1 overflow-y-auto p-4 space-y-3 pb-safe-area custom-scrollbar touch-pan-y"
                        style="-webkit-overflow-scrolling: touch;">
                        <button v-for="(day, idx) in itinerary" :key="idx" @click="selectDay(idx)"
                            class="w-full text-left p-5 rounded-2xl transition-all flex items-center gap-4 group relative overflow-hidden"
                            :class="currentIndex === idx ? 'bg-cyan-900/30 border border-cyan-500/50 shadow-[0_0_15px_rgba(8,145,178,0.2)]' : 'bg-slate-800/50 border border-slate-700 hover:bg-slate-800'">
                            <div v-if="currentIndex === idx" class="absolute left-0 top-0 bottom-0 w-1.5 bg-cyan-500">
                            </div>
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0 font-mono font-bold text-lg"
                                :class="currentIndex === idx ? 'bg-cyan-500 text-white' : 'bg-slate-700 text-slate-400 group-hover:bg-slate-600 group-hover:text-slate-200'">
                                {{ day.day }}
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-1.5">
                                    <span class="font-bold text-lg truncate pr-2"
                                        :class="currentIndex === idx ? 'text-cyan-100' : 'text-slate-300 group-hover:text-white'">
                                        {{ day.locations[day.locations.length - 1] }}
                                    </span>
                                    <span
                                        class="text-xs px-2 py-0.5 rounded bg-slate-900 text-slate-400 font-mono border border-slate-700">
                                        {{ day.altitude.sleep }}m
                                    </span>
                                </div>
                                <div class="text-sm truncate w-full"
                                    :class="currentIndex === idx ? 'text-cyan-300/70' : 'text-slate-500 group-hover:text-slate-400'">
                                    {{ day.title }}
                                </div>
                            </div>
                            <span v-if="currentIndex === idx"
                                class="material-icons-outlined text-cyan-500 text-xl">check</span>
                        </button>
                        <div class="h-8"></div>
                    </div>
                </div>
            </transition>
        </teleport>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted } = Vue;

        createApp({
            setup() {
                const itinerary = ref([]);
                const currentIndex = ref(0);
                const loading = ref(true);
                const error = ref(null);
                const isDrawerOpen = ref(false);
                const simulatedToday = '2026-04-01';
                const width = ref(window.innerWidth);

                const onResize = () => {
                    width.value = window.innerWidth;
                    if (width.value >= 768) {
                        isDrawerOpen.value = false;
                    }
                };

                const loadItinerary = async () => {
                    try {
                        loading.value = true;
                        const response = await fetch('./itinerary_data.json');
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const data = await response.json();
                        itinerary.value = data;
                        resetToToday();
                    } catch (e) {
                        console.error("Loading failed:", e);
                        error.value = e.message;
                    } finally {
                        loading.value = false;
                    }
                };

                const currentDay = computed(() => {
                    if (itinerary.value.length === 0) return null;
                    return itinerary.value[currentIndex.value];
                });

                const googleMapsLink = computed(() => {
                    if (!currentDay.value) return '#';
                    // Generate Google Maps Search Link based on current location
                    // Use the last location in the list for better accuracy (usually the destination)
                    const locations = currentDay.value.locations;
                    const destination = locations[locations.length - 1];
                    return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent('西藏 ' + destination)}`;
                });

                const isHighAltitude = computed(() => {
                    if (!currentDay.value) return false;
                    return currentDay.value.altitude.max > 3500 || currentDay.value.altitude.sleep > 3500;
                });

                const isToday = computed(() => {
                    if (!currentDay.value) return false;
                    return currentDay.value.date === simulatedToday;
                });

                const changeDay = (delta) => {
                    const newIndex = currentIndex.value + delta;
                    if (newIndex >= 0 && newIndex < itinerary.value.length) {
                        currentIndex.value = newIndex;
                        const scrollContainer = document.querySelector('div.overflow-y-auto.custom-scrollbar.pb-32');
                        if (scrollContainer) scrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                };

                const selectDay = (index) => {
                    currentIndex.value = index;
                    isDrawerOpen.value = false;
                    const scrollContainer = document.querySelector('div.overflow-y-auto.custom-scrollbar.pb-32');
                    if (scrollContainer) scrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
                };

                const resetToToday = () => {
                    const foundIndex = itinerary.value.findIndex(d => d.date === simulatedToday);
                    if (foundIndex !== -1) {
                        currentIndex.value = foundIndex;
                    } else {
                        currentIndex.value = 0;
                    }
                };

                onMounted(() => {
                    loadItinerary();
                    window.addEventListener('resize', onResize);
                });

                onUnmounted(() => {
                    window.removeEventListener('resize', onResize);
                });


                return {
                    itinerary,
                    currentIndex,
                    currentDay,
                    loading,
                    error,
                    isHighAltitude,
                    isToday,
                    isDrawerOpen,
                    width,
                    googleMapsLink, // Exposed
                    changeDay,
                    selectDay,
                    resetToToday
                };
            }
        }).mount('#app');
    </script>
</body>

</html>